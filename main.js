(()=>{"use strict";var t={baseUrl:"https://nomoreparties.co/v1/wff-cohort-10",headers:{authorization:"4988e7fc-55bd-42c1-ae9f-ec575699ec2a","Content-Type":"application/json"}},e=function(e,n){return fetch(t.baseUrl.concat("/","cards/likes").concat("/",e),{method:n,headers:{authorization:t.headers.authorization}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){return Promise.reject("Не удалось выполнить запрос: ".concat(t))}))},n=function(t,e,n,o,r,c){var a=t.querySelector(".places__item").cloneNode(!0);a.dataset.id=e._id;var i=a.querySelector(".card__image"),u=a.querySelector(".card__delete-button"),s=a.querySelector(".card__title"),l=a.querySelector(".card__like-button"),d=a.querySelector(".card__like-counter");return i.src=e.link,i.alt=e.name,s.textContent=e.name,d.textContent=e.likes.length,c&&l.classList.add("card__like-button_is-active"),i.addEventListener("click",(function(){return o(e)})),l.addEventListener("click",(function(){return r(l,d,e)})),n?u.addEventListener("click",(function(){n(e)})):u.classList.add("card__delete-button_inactive"),a},o=function(t,n,o){var r;t.classList.contains("card__like-button_is-active")?(r=o._id,e(r,"DELETE")).then((function(e){n.textContent=e.likes.length,t.classList.remove("card__like-button_is-active")})).catch((function(t){console.log("Ошибка: ".concat(t))})):function(t){return e(t,"PUT")}(o._id).then((function(e){n.textContent=e.likes.length,t.classList.add("card__like-button_is-active")})).catch((function(t){console.log("Ошибка: ".concat(t))}))},r=function(t){document.addEventListener("keydown",a),t.classList.add("popup_is-opened")},c=function(t){document.removeEventListener("keydown",a),t.classList.remove("popup_is-opened")},a=function(t){if("Escape"===t.key){var e=document.querySelector(".popup_is-opened");c(e)}},i=function(t){if(t.stopPropagation(),t.target.classList.contains("popup")||t.target.classList.contains("popup__close")){var e=t.target.closest(".popup");c(e)}},u=function(t,e,n){var o=t.querySelector(".".concat(e.id,"-error"));o.classList.remove(n.errorClass),o.textContent="",e.classList.remove(n.inputErrorClass)},s=function(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?e.classList.remove(n.inactiveButtonClass):e.classList.add(n.inactiveButtonClass)},l=function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);n.forEach((function(n){n.setCustomValidity(""),u(t,n,e)})),s(n,o,e)},d={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"},p=document.querySelector("#card-template").content,f=document.querySelector(".places__list"),m=document.querySelector(".popup_type_edit"),_=document.querySelector(".popup_type_new-card"),v=document.querySelector(".popup_type_change-avatar"),h=document.querySelector(".popup_type_delete-card"),y=document.querySelector(".popup_type_image"),S=y.querySelector(".popup__image"),b=y.querySelector(".popup__caption"),C=document.querySelectorAll(".popup, .popup__close"),k=document.querySelector(".profile__edit-button"),q=document.querySelector(".profile__add-button"),L=document.querySelector(".profile__avatar-button"),g=document.forms["edit-profile"],E=g.elements.name,x=g.elements.description,j=g.elements.button,P=m.querySelector(".popup__error"),z=document.forms["new-place"],A=z.elements["place-name"],U=z.elements.link,D=z.elements.button,T=_.querySelector(".popup__error"),w=document.forms["change-avatar"],B=w.elements.avatar,N=w.elements.button,O=v.querySelector(".popup__error"),J=document.forms["delete-card"],M=J.elements.cardid,V=J.elements.button,H=h.querySelector(".popup__error"),I=document.querySelector(".profile__title"),F=document.querySelector(".profile__description"),G=document.querySelector(".profile__image"),K=function(t,e){t.classList.add("popup__error_active"),t.textContent=e},Q=function(t){t.classList.remove("popup__error_active"),t.textContent=""},R=function(t){var e=t.link,n=t.name;S.src=e,S.alt=n,b.textContent=n,r(y)},W=function(t){M.value=t._id,l(J,d),V.addEventListener("click",X),r(h)},X=function e(n){n.preventDefault();var o=document.querySelector('[data-id="'.concat(M.value,'"]'));o?(V.textContent=V.dataset.loading,function(e,n){return function(e){return fetch(t.baseUrl.concat("/","cards").concat("/",e),{method:"DELETE",headers:{authorization:t.headers.authorization}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){return Promise.reject("Не удалось выполнить запрос: ".concat(t))}))}(n).then((function(){e.remove()})).catch((function(t){console.log("Ошибка: ".concat(t))}))}(o,M.value).then((function(t){J.reset(),c(h)})).catch((function(t){K(H,"Ошибка: ".concat(t))})).finally((function(){V.textContent=V.dataset.text}))):K(H,"Ошибка: Указанная карточка не найдена!"),n.target.removeEventListener("click",e)};k.addEventListener("click",(function(){E.value=I.textContent,x.value=F.textContent,Q(P),l(g,d),r(m)})),q.addEventListener("click",(function(){z.reset(),Q(T),l(z,d),r(_)})),L.addEventListener("click",(function(){w.reset(),Q(O),l(w,d),r(v)})),g.addEventListener("submit",(function(e){var n,o;e.preventDefault(),j.textContent=j.dataset.loading,(n=E.value,o=x.value,fetch(t.baseUrl.concat("/","users/me"),{method:"PATCH",headers:t.headers,body:JSON.stringify({name:n,about:o})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){return Promise.reject("Не удалось выполнить запрос: ".concat(t))}))).then((function(t){I.textContent=t.name,F.textContent=t.about,c(m)})).catch((function(t){K(P,"Ошибка: ".concat(t))})).finally((function(){j.textContent=j.dataset.text}))})),z.addEventListener("submit",(function(e){var r,a;e.preventDefault(),D.textContent=D.dataset.loading,(r=A.value,a=U.value,fetch(t.baseUrl.concat("/","cards"),{method:"POST",headers:t.headers,body:JSON.stringify({name:r,link:a})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){return Promise.reject("Не удалось выполнить запрос: ".concat(t))}))).then((function(t){var e=n(p,t,W,R,o,!1);f.prepend(e),z.reset(),c(_)})).catch((function(t){K(T,"Ошибка: ".concat(t))})).finally((function(){D.textContent=D.dataset.text}))})),w.addEventListener("submit",(function(e){var n;e.preventDefault(),N.textContent=N.dataset.loading,(n=B.value,fetch(n,{}).then((function(t){return t.ok?Promise.resolve(t.headers.get("content-type").includes("image")):Promise.reject(t.status)})).catch((function(t){return Promise.reject(t)}))).then((function(e){var n;e?(n=B.value,fetch(t.baseUrl.concat("/","users/me/avatar"),{method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:n})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){return Promise.reject("Не удалось выполнить запрос: ".concat(t))}))).then((function(t){G.style.backgroundImage="url(".concat(t.avatar,")"),w.reset(),c(v)})).catch((function(t){K(O,"Ошибка: ".concat(t))})):K(O,"Ссылка не является изображением!")})).catch((function(t){K(O,"Ошибка: ".concat(t))})).finally((function(){N.textContent=N.dataset.text}))})),C.forEach((function(t){t.addEventListener("click",i)}));var Y=[fetch(t.baseUrl.concat("/","users/me"),{headers:{authorization:t.headers.authorization}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){return Promise.reject("Не удалось выполнить запрос: ".concat(t))})),fetch(t.baseUrl.concat("/","cards"),{headers:{authorization:t.headers.authorization}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){return Promise.reject("Не удалось выполнить запрос: ".concat(t))}))];Promise.all(Y).then((function(t){I.textContent=t[0].name,F.textContent=t[0].about,G.style.backgroundImage="url(".concat(t[0].avatar,")");var e=t[0]._id;t[1].forEach((function(t){var r=null,c=!1;t.owner._id===e&&(r=W),t.likes.some((function(t){return t._id===e}))&&(c=!0);var a=n(p,t,r,R,o,c);f.append(a)}))})).catch((function(t){console.log("Ошибка: ".concat(t))})),function(t){Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){e.addEventListener("submit",(function(t){t.preventDefault()})),function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);s(n,o,e),n.forEach((function(r){r.addEventListener("input",(function(){!function(t,e,n){e.validity.valid?u(t,e,n):(e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),function(t,e,n,o){var r=t.querySelector(".".concat(e.id,"-error"));r.textContent=n,r.classList.add(o.errorClass),e.classList.add(o.inputErrorClass)}(t,e,e.validationMessage,n))}(t,r,e),s(n,o,e)}))}))}(e,t)}))}(d)})();